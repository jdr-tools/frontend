{"code":"!function(e){var t={};function a(s){if(t[s])return t[s].exports;var r=t[s]={i:s,l:!1,exports:{}};return e[s].call(r.exports,r,r.exports,a),r.l=!0,r.exports}a.m=e,a.c=t,a.d=function(e,t,s){a.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:s})},a.r=function(e){Object.defineProperty(e,\"__esModule\",{value:!0})},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,\"a\",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p=\"\",a(a.s=0)}([function(e,t,a){\"use strict\";a.r(t);var s={controller:class{constructor(e,t,a){\"ngInject\";this.auth=e,this.authenticated=e.checkSessionKeysPresence(!1),this.storage=t,this.setUsername();const s=this;a.$on(\"loginSuccessful\",()=>{s.authenticated=!0,s.setUsername()})}logout(){this.authenticated=!1,this.auth.destroyUserSession()}setUsername(){this.authenticated&&(this.username=this.storage.account.username)}},controllerAs:\"vm\",templateUrl:\"/src/components/menus/app/app_menu.html\"};var r=angular.module(\"arkaan.frontend.components.menus.app\",[]).component(\"appMenu\",s).name;var n={controller:class{constructor(e,t){\"ngInject\";this.auth=e,this.authenticated=e.checkSessionKeysPresence(!1)}},controllerAs:\"vm\",templateUrl:\"/src/components/menus/admin/admin_menu.html\"};var o=angular.module(\"arkaan.frontend.components.menus.admin\",[]).component(\"adminMenu\",n).name;var c={controller:class{constructor(e,t){this.translate=e}selectLanguage(e){this.translate.use(e)}},controllerAs:\"vm\",templateUrl:\"/src/components/custom_footer/custom_footer.html\"};const i=[angular.module(\"arkaan.frontend.components.menus\",[r,o]).name,angular.module(\"arkaan.frontend.components.custom_footer\",[]).component(\"customFooter\",c).name];var l=angular.module(\"arkaan.frontend.components\",i).name;var u=function(e){\"ngInject\";e.otherwise(\"/dashboard\")};var d=function(e,t){\"ngInject\";t.addPart(\"errors\"),t.addPart(\"common\"),t.addPart(\"components/main_menu\"),t.addPart(\"components/custom_footer\"),e.useLoader(\"$translatePartialLoader\",{urlTemplate:\"/locales/{part}/{lang}.json\"}),e.preferredLanguage(\"fr\")};var m=e=>{\"ngInject\";e.state({name:\"app\",templateUrl:\"src/modules/app/index.html\",resolve:{setSection:e=>{e.section=\"app\"}}}),e.state({name:\"admin\",templateUrl:\"src/modules/admin/index.html\",resolve:{setSection:e=>{e.section=\"admin\"}}})};var p=angular.module(\"arkaan.frontend.configuration\",[]).config(u).config(d).config(m).name;var g=function(e,t){\"ngInject\";const a=e[0];return{transclude:a.transclude,priority:a.priority,terminal:a.terminal,restrict:a.restrict,link:function(e,s,r){r.ngIf=(()=>t.checkPresence(r.displayRight)),a.link.apply(a,arguments)}}};var h=angular.module(\"arkaan.frontend.directives\",[]).directive(\"displayRight\",g).name;var f=class{constructor(){\"ngInject\";this.accounts=[\"babausse\",\"babaussine\"]}};var v=function(e,t,a){\"ngInject\";const s=this;s.account={username:\"\",password:\"\",password_confirmation:\"\",email:\"\",lastname:\"\",firstname:\"\",birthdate:new Date(1970,0,0)},s.confirmation=!1,s.errors=!1,s.createAccount=(()=>{t.post(\"/accounts\",s.account,{successCallback:s.confirm,errorCallback:s.displayErrors})}),s.confirm=(()=>{s.confirmation=!0,s.errors=!1}),s.displayErrors=(e=>a.append(s.accountCreationForm,e))};var k=function(e){\"ngInject\";return this.get=((t,a)=>{e.get(`/accounts/${t}`,{},{successCallback:a})}),this.own=(t=>{e.get(\"/accounts/own\",{},{successCallback:t})}),this};var C=function(e){\"ngInject\";e.state(\"accounts\",{parent:\"app\",resolve:{authentication:e=>{e.checkAndRedirect()}}}),e.state(\"accountsList\",{url:\"/accounts\",parent:\"accounts\",templateUrl:\"src/modules/app/accounts/list/accounts_list.html\",controller:\"accountsListController as vm\"}),e.state(\"accountsCreate\",{url:\"/accounts/new\",templateUrl:\"src/modules/app/accounts/create/accounts_create.html\",controller:\"accountsCreateController as vm\",resolve:{authentication:(e,t)=>{e.checkSessionKeysPresence(!1)&&t.go(\"dashboard\")}}})};var b=angular.module(\"arkaan.frontend.accounts\",[]).controller(\"accountsListController\",f).controller(\"accountsCreateController\",v).factory(\"AccountsFactory\",k).config(C).run(e=>e.addPart(\"accounts\")).name;var y=function(e,t,a){\"ngInject\";const s=this;s.getAllCampaigns=(()=>{a.list(e=>{s.campaigns=e})}),s.deleteCampaign=(e=>{a.delete(e,s.getAllCampaigns)}),t.$on(\"campaign.created\",s.getAllCampaigns),s.getAllCampaigns()};var j=function(e,t,a){\"ngInject\";const s=this;s.failure=(e=>ErrorsService.append(s.campaignEditionForm,e)),s.initialize=(()=>{a.get(t.params.id,e=>{s.campaign=e})}),s.success=(()=>{const t=e.simple().position(\"bottom right\").textContent(\"Campagne mise à jour avec succès\").hideDelay(2e3);e.show(t),s.initialize()}),s.update=(()=>{const e=_.pick(s.campaign,[\"title\",\"description\",\"tags\",\"is_private\"]);a.update(t.params.id,e,s.success,s.failure)}),s.initialize()};var I=function(e){\"ngInject\";return this.create=((t,a,s)=>{e.post(\"/campaigns\",t,{successCallback:a,errorCallback:s})}),this.delete=((t,a)=>{e.delete(`/campaigns/${t}`,{successCallback:a})}),this.get=((t,a)=>{e.get(`/campaigns/${t}`,{},{successCallback:a})}),this.list=(t=>{e.get(\"/campaigns\",{},{successCallback:t})}),this.update=((t,a,s,r)=>{e.put(`/campaigns/${t}`,a,{successCallback:s,errorCallback:r})}),this};var R=function(e){\"ngInject\";e.state(\"campaigns\",{parent:\"app\",resolve:{authentication:e=>{e.checkAndRedirect()}}}),e.state(\"campaigns.index\",{url:\"/campaigns\",templateUrl:\"src/modules/app/campaigns/index/campaigns_list.html\",controller:\"campaignsListController as vm\"}),e.state(\"campaigns.edit\",{url:\"/campaigns/{id}\",templateUrl:\"src/modules/app/campaigns/edit/campaigns_edit.html\",controller:\"campaignsEditController as vm\"})};var S={controller:function(e,t,a,s,r){\"ngInject\";const n=this,o=(t,a)=>{t.campaign={title:\"\",isPrivate:!0,description:\"\",tags:[],creator_id:e.account.id},t.close=(()=>a.cancel()),t.closeAndRefresh=(()=>a.hide()),t.handleErrors=(e=>r.append(t.campaignCreationForm,e)),t.validate=(()=>s.create(t.campaign,t.closeAndRefresh,t.handleErrors))};n.onCreation=(()=>{a.$broadcast(\"campaign.created\")}),n.createCampaign=(e=>{t.show({controller:o,templateUrl:\"/src/modules/app/campaigns/components/modals/create/campaigns_create_modal.html\",parent:angular.element(document.body),targetEvent:e,clickOutsideToClose:!0}).then(n.onCreation)})},controllerAs:\"vm\",templateUrl:\"/src/modules/app/campaigns/components/modals/create/campaigns_create.html\"};var U=angular.module(\"arkaan.frontend.campaigns.components.modals.create\",[]).component(\"campaignsCreate\",S).name;var $=angular.module(\"arkaan.frontend.campaigns.components\",[U]).name;var P=class{constructor(e,t){\"ngInject\";this.section=t.section}};var E=function(e){\"ngInject\";e.state(\"dashboard\",{url:\"/dashboard\",parent:\"app\",templateUrl:\"src/modules/app/dashboard/dashboard.html\",controller:\"dashboardController as vm\"})};var A=function(e,t,a){\"ngInject\";const s=this;s.currentDate=new Date,s.cleanAccount=(()=>{const e=angular.copy(s.account);return\"\"==e.password&&delete e.password,\"\"==e.password_confirmation&&delete e.password_confirmation,e}),s.initialize=(()=>{t.get(\"/accounts/own\",{},{successCallback:e=>{s.account=_.omit(e.account,\"rights\")}})}),s.handleErrors=(e=>{a.append(s.profileEditionForm,e)}),s.success=(()=>{const t=e.simple().position(\"bottom right\").textContent(\"Compte mis à jour avec succès\").hideDelay(2e3);e.show(t),s.initialize()}),s.submit=(()=>{t.put(\"/accounts/own\",s.cleanAccount(),{successCallback:s.success,errorCallback:s.handleErrors})}),s.initialize()};var w=function(e){\"ngInject\";e.state(\"profile\",{parent:\"app\",url:\"/profile\",templateUrl:\"src/modules/app/profile/profile.html\",controller:\"profileController as vm\",resolve:{authentication:e=>{e.checkAndRedirect()}}})};var F=function(e,t){\"ngInject\";const a=this;a.username=e.remember||\"\",a.password=\"\",a.remember=!!e.remember,a.auth=t,a.authenticate=(()=>{t.createUserSession(a.username,a.password,a.remember,a.handleErrors)}),a.handleErrors=(e=>{a.sessionCreationForm.username.$setValidity(\"credentials\",!1)}),a.resetCredentialsError=(()=>{a.sessionCreationForm.username.$setValidity(\"credentials\",!0)})};var K=function(e){e.state(\"sessionsCreate\",{url:\"/sessions/new\",parent:\"app\",templateUrl:\"src/modules/app/sessions/create/sessions_create.html\",controller:\"sessionsCreateController as vm\",resolve:{authentication:(e,t)=>{\"ngInject\";e.checkSessionKeysPresence(!1)&&t.go(\"dashboard\")}}})};const L=[b,angular.module(\"arkaan.frontend.campaigns\",[$]).controller(\"campaignsListController\",y).controller(\"campaignsEditController\",j).factory(\"campaignsFactory\",I).config(R).run(e=>e.addPart(\"campaigns\")).name,angular.module(\"arkaan.frontend.dashboard\",[]).config(E).controller(\"dashboardController\",P).name,angular.module(\"arkaan.frontend.app.profile\",[]).config(w).controller(\"profileController\",A).name,angular.module(\"arkaan.frontend.sessions\",[]).controller(\"sessionsCreateController\",F).config(K).run(e=>e.addPart(\"sessions\")).name];var x=angular.module(\"arkaan.frontend.app\",L).name;var G=class{constructor(e){\"ngInject\"}};var D=function(e){\"ngInject\";e.state(\"adminDashboard\",{url:\"/admin\",parent:\"admin\",templateUrl:\"src/modules/admin/dashboard/admin_dashboard.html\",controller:\"adminDashboardController as vm\"})};var O=function(e,t,a,s,r){\"ngInject\";const n=this;n.groups=[],n.group={slug:\"\"},n.services=[],n.categories=[],n.typeCorrespondance={routes:\"services\",rights:\"categories\"},n.createGroup=(()=>{s.create(n.group,n.getGroups)}),n.deleteGroup=(e=>{s.delete(e,n.getGroups)}),n.editElements=((e,a,s=!1)=>{t.$broadcast(`update_${e}`,a.id)}),n.getGroups=(()=>{s.list(n.setGroups)}),n.setGroups=(e=>{n.groups=e.items}),t.$on(\"refreshGroupsList\",n.getGroups),r.list(e=>{n.services=e.items}),a.list(e=>{n.categories=e.items}),n.getGroups()};var q=function(e){\"ngInject\";const t=this;return t.create=((t,a)=>{e.post(\"/groups\",t,{successCallback:a})}),t.delete=((t,a)=>{e.delete(`/groups/${t}`,{successCallback:a})}),t.get=((t,a)=>{e.get(`/groups/${t}`,{},{successCallback:a})}),t.list=(t=>{e.get(\"/groups\",{},{successCallback:t})}),t.updateRights=((t,a,s)=>{e.patch(`/groups/${t}/rights`,{rights:a},{successCallback:s})}),t.updateRoutes=((t,a,s)=>{e.patch(`/groups/${t}/routes`,{routes:a},{successCallback:s})}),t};var T=function(e){\"ngInject\";return this.list=(t=>{e.get(\"/services\",{},{successCallback:t})}),this};var z=function(e){\"ngInject\";e.state(\"groups\",{parent:\"admin\",resolve:{authentication:e=>{e.checkAndRedirect()}}}),e.state(\"groups.index\",{url:\"/groups\",templateUrl:\"src/modules/admin/groups/index/groups_list.html\",controller:\"groupsListController as vm\"})};var M={templateUrl:\"src/modules/admin/groups/components/update_left_panel/update_left_panel.html\",controller:function(e,t,a,s){\"ngInject\";const r=this;r.groupId=!1,r.correspondance={rights:\"key\",routes:\"slug\"},a.$watch(\"vm.loopKey\",()=>{t.$on(`update_${r.loopKey}`,(e,t)=>{r.groupId=t,s.get(t,r.selectElements)})}),r.selectElements=(e=>{r.collection=r.collection.map(t=>(t[r.loopKey]=t[r.loopKey].map(t=>(t.selected=e[r.loopKey].indexOf(t.id)>=0,t)),t)),r.toggle()}),r.update=(()=>{const e=[];r.collection.forEach(t=>{t[r.loopKey].forEach(t=>{t.selected&&e.push(t.id)})});const t=r.loopKey.charAt(0).toUpperCase()+r.loopKey.slice(1);s[`update${t}`](r.groupId,e,r.close)}),r.toggle=(()=>{e(`${r.loopKey}-panel`).toggle()}),r.close=(()=>{t.$broadcast(\"refreshGroupsList\"),r.toggle()})},controllerAs:\"vm\",bindings:{collection:\"=\",loopKey:\"@\",titleKey:\"@\"}};var V=function(e,t,a){\"ngInject\";const s=this;s.categories=[],s.category={slug:\"\"},s.rights={},s.createCategory=(()=>{t.create(s.category,s.getRights)}),s.createRight=(e=>{a.create(e,s.rights[e],s.getRights)}),s.deleteCategory=(e=>{t.delete(e,s.getRights)}),s.deleteRight=(e=>{a.delete(e,s.getRights)}),s.getRights=(()=>{t.list(s.setCategories)}),s.setCategories=(e=>{s.category.slug=\"\",s.categories=e.items,s.rights={},s.categories.forEach(e=>{s.rights[e.id]=\"\"})}),s.getRights()};var H=function(e){return this.create=((t,a,s)=>{e.post(\"/rights\",{category_id:t,slug:a},{successCallback:s})}),this.delete=((t,a)=>{e.delete(`/rights/${t}`,{successCallback:a})}),this};var N=function(e){return this.create=((t,a)=>{e.post(\"/categories\",t,{successCallback:a})}),this.delete=((t,a)=>{e.delete(`/categories/${t}`,{successCallback:a})}),this.list=(t=>{e.get(\"/categories\",{},{successCallback:t})}),this};var Q=function(e){\"ngInject\";e.state(\"rights\",{parent:\"admin\",resolve:{authentication:e=>{e.checkAndRedirect()}}}),e.state(\"rightsList\",{url:\"/rights\",parent:\"rights\",templateUrl:\"src/modules/admin/rights/list/rights_list.html\",controller:\"rightsListController as vm\",resolve:{right:e=>{e.checkAndRedirect(\"administration.rights\",\"adminDashboard\")}}})};const X=[angular.module(\"arkaan.frontend.admin.dashboard\",[]).config(D).controller(\"adminDashboardController\",G).name,angular.module(\"arkaan.frontend.groups\",[]).controller(\"groupsListController\",O).component(\"updateLeftPanel\",M).factory(\"GroupsFactory\",q).factory(\"ServicesFactory\",T).config(z).run(e=>e.addPart(\"groups\")).name,angular.module(\"arkaan.frontend.rights\",[]).controller(\"rightsListController\",V).factory(\"RightsFactory\",H).factory(\"CategoriesFactory\",N).config(Q).run(e=>e.addPart(\"rights\")).name];const B=[x,angular.module(\"arkaan.frontend.admin\",X).name];var J=angular.module(\"arkaan.frontend.modules\",B).name;var W=class{constructor(e,t,a,s,r){\"ngInject\";this.storage=a,this.api=e,this.accounts=t,this.state=r,this.scope=s}checkAndRedirect(){return this.checkSessionKeysPresence()&&this.checkForInvalidSession()}checkSessionKeysPresence(e=!0){const t=!!this.storage.account&&!!this.storage.token;return!t&&e&&this.destroyUserSession(),t}checkForInvalidSession(){this.api.get(`/sessions/${this.storage.token}`,{successCallback:this.checkForHijackedSession,errorCallback:this.destroyUserSession})}checkForHijackedSession(e){e.username!=this.storage.account.username&&this.destroyUserSession()}createUserSession(e,t,a,s){const r=this;this.api.post(\"/sessions\",{username:e,password:t},{successCallback:t=>{a&&(this.storage.remember=e),r.storage.token=t.token,r.accounts.get(t.account_id,e=>{r.storage.account=e.account,r.scope.$broadcast(\"loginSuccessful\"),r.state.go(\"dashboard\",{},{reload:!0})})},errorCallback:s,skipSessionId:!0})}destroyUserSession(){const e=this;this.api.delete(`/sessions/${e.storage.token}`,{successCallback:()=>{delete e.storage.account,delete e.storage.token,e.state.go(\"sessionsCreate\")}})}};var Y=class{constructor(e,t){this.account=e.account,this.state=t}checkAndRedirect(e,t){this.checkPresence(e)||this.state.go(t)}checkPresence(e){let t=!1;return this.account.rights.forEach(a=>{a.slug==e&&(t=!0)}),t}};var Z=class{constructor(e,t,a){\"ngInject\";this.http=e,this.jquery=a.jQuery,this.storage=t}post(e,t={},a={}){this.makeRequest(\"POST\",e,t,a)}get(e,t={},a={}){this.makeRequest(\"GET\",e,t,a)}patch(e,t={},a={}){this.makeRequest(\"PATCH\",e,t,a)}put(e,t={},a={}){this.makeRequest(\"PUT\",e,t,a)}delete(e,t={}){this.makeRequest(\"DELETE\",e,{},t)}makeRequest(e,t,a,s){const r={method:\"POST\",url:\"/api\",headers:{X_CSRF_TOKEN:this.jquery(\"input[name=_csrf]\").val()},data:angular.extend({},a,{url:t,method:e})};return 1!=s.skipSessionId&&(r.data.session_id=this.storage.token),this.http(r).then(e=>{s.successCallback&&s.successCallback(e.data)},e=>{s.errorCallback&&s.errorCallback(e.data)})}};var ee=function(){\"ngInject\";return this.append=((e,t)=>{if(_.has(t,\"errors\"))_.each(t.errors,t=>{const a=_.split(t,\".\");e[a[1]].$setValidity(a[2],!1)});else if(_.has(t,\"message\")&&t.message.indexOf(\"missing.\")>=0){const a=_.split(t.message,\".\");e[a[1]].$setValidity(\"required\",!1)}}),this};var te=angular.module(\"arkaan.frontend.services\",[]).service(\"Authentication\",W).service(\"Permissions\",Y).service(\"Api\",Z).service(\"ErrorsService\",ee).name;angular.module(\"arkaan.frontend\",[\"ngStorage\",\"ngMaterial\",\"ngMessages\",\"pascalprecht.translate\",\"ui.router\",l,p,h,J,te])}]);","extractedComments":[]}